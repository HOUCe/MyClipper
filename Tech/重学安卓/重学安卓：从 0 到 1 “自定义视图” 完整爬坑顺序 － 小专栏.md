---
created: 2021-10-13
source: https://xiaozhuanlan.com/topic/9361075842
author: 
---

# [重学安卓：从 0 到 1 “自定义视图” 完整爬坑顺序 － 小专栏](https://xiaozhuanlan.com/topic/9361075842)


> [往期回顾](https://kunminx.gitbook.io/relearn-android/new_moments/zhong-xue-an-zhuo-liang-zhou-nian-hui-gu-yu-zhan-wang)，**[专栏目录](https://kunminx.gitbook.io/relearn-android/category)**，**[更新动态](https://kunminx.gitbook.io/relearn-android/new_moments)**，[优惠政策](https://kunminx.gitbook.io/relearn-android/ban-quan-sheng-ming#you-hui-zheng-ce)，[版权须知](https://kunminx.gitbook.io/relearn-android/ban-quan-sheng-ming#ban-quan-xu-zhi)
> 
> 温馨提示：如果这是第一次接触《重学安卓》，可通过上述链接来访问和快速了解《重学安卓》专栏、获取它的目录、试读内容，以及了解它的最新动态 和 发展状况。
> 
> 截至目前，专栏已对 **体系化文章** 做了 1970 余次修订，数十位群友告诉我 受专栏的启发 他们也开启了写作之路。群里不定期会有小伙伴讨论适配问题、分享原创的开源库 和 提供内推机会，订阅后可随时进群交流。

·

> Note 2021.5.25 **重要提示**：
> 
> 阅读本文的最佳时机是，**您已吃过** 阅读 “源码” 或 “源码分析文” 时 **找不到头绪的苦**。
> 
> 您还没吃过苦，那您先不要着急阅读本文。您得吃过苦，才会有体会。
> 
> 在您吃够这方面的苦后，您才有机会发现，本文正是专用于解决 “如何选择和归类自定义控件” 的困扰。
> 
> 我们 **绝不通篇贴源码**，而是基于广泛的实践和反思，在累积过大量样本 乃至足以排除掉所有干扰信息后，**点到为止地揭露 “视图交互 乃至 产品设计” 最为核心的本质**，方便您理解背后的底层逻辑，乃至可以笃信地 选择或实现合适的自定义控件在项目中使用。

## 前言

在过去的几个月中，我们分别 深入浅出地复盘了 视图控制器的 **生命周期、重建机制、状态管理、页面通信、路由导航**，以及作为 标准化开发模式的 **Jetpack MVVM 最佳实践**。

相信经过几个月的实践、反思和沉淀，小伙伴们对作为 “应用开发骨架” 的 “视图控制器” 及其 “标准化开发框架” 已胸有成竹。

本来随后我是想直接开讲自定义视图，但如果像其他网文一样，一上来就介绍细枝末节的技术点，那恐怕会很让人感到沮丧，找不到支点来立足和展开。

> 并且值得注意的是，**自定义视图学习的切入点，并不全在技术领域内**。

因此，在正式开讲自定义视图的技术知识之前，我决定 **通过这样一篇 “导读” 来做个预热**，方便小伙伴们对后续章节具体内容的学习。

## 文章目录一览

-   前言
-   死记硬背时期 的混沌世界
-   深度思考眼中 的自定义视图
    -   对现存自定义视图的学习
    -   对视图标准化 API 的学习
-   综上
-   **Note 2021.08.15 加餐：**
    -   **从 0 到 1 “自定义视图” 完整爬坑顺序**
-   **Note 2020.07.07 加餐：**
    -   重学安卓 开源库 内部共享计划

## 死记硬背时期 的混沌世界

记得刚参加工作不久的时候，我也和多数人一样，思维还停留在 学生时代 死记硬背的水平，老想着 大而全、蛇吞象，想把所有东西都整理好、强迫自己记下来。

最初我的策略是，将控件 按覆盖面积 分类，例如 导航类、表单类、展示类、容器类，等等。然后不断地收集关于它们的第三方库、Google 自家控件的知识点等等。

一开始是有一点效果，知道控件怎么用，但也就到这种程度为止，过一段时间，便通通遗忘。

更糟糕的是，这种 **不科学的管理方式，使得对控件的管理逐渐失控**，每当有新的控件被我相中时，我却不知道将其归类到哪个目录下为好。

![](https://images.xiaozhuanlan.com/photo/2019/1b9424e73b7017e91453ad17da387366.png)

我相信很多人都有过这样的经历，**最开始十分努力，后来不了了之**。

有的人从此开启了咸鱼模式，反正这也学不好，那也学不好，干脆得过且过、混吃等死。另有的人则是加倍努力，然后背下来的知识，也加倍地忘记 …

那么有多少人真的反思过，**是不是自己的思考方式出了问题呢**？

由于时间过去了太久，我不想展开介绍 从死记硬背 到深度思考，这期间我究竟经历了些什么，乃至于有了这样的领悟。但正如你们看到的，前面几期关于视图控制和 MVVM 深入浅出的介绍，都是来自深度思考的结果。

**深度思考 不一定能带来 绝对正确的结论，但却一定是自恰的、能让自己信服从而义无反顾地行动**。

深度思考的精髓就在于 **探究为什么、探究事物存在的缘由。凡事把这个想明白，就能透过现象抓住本质**。（详见 [《基本功：是随时随地可受用的 深度思考原则》](https://xiaozhuanlan.com/topic/9837051426) 篇的解析）

## 深度思考眼中的自定义视图

所以，在形成了深度思考的习惯后，我对视图的学习，也发生了翻天覆地的变化。

不再是一上来就 死记硬背是什么 和 练习怎么用。

而是首先思考，自定义视图 为什么存在？（凡是 View 的实现类，都算自定义视图，不要觉得 Google 默认实现的就不算、只有自己实现的才算）

**视图的存在，对用户来说，是为了满足 所见即所得 的人机交互需求；对开发者来说，是为了能够定制视图 来提供合适的用户体验。**

换言之，

若不是为了满足用户 对 **所见即所得** 的需求，视图根本不需要存在，给个黑底白字的命令行就行了。

若不是为了让开发者 能够定制视图 来提供合适的用户体验，视图也不需要通过 模版方法模式 和 组合模式 来 **设计出标准化的 API、供开发者定制、并且由 统一的视图管理机制 在后台运筹帷幄**。

所以至此，我们发掘并确立了视图的两大学习方向：

### 1.对现存自定义视图的学习

如果你想掌握 市面上已有的 自定义视图，例如 RecyclerView，那么 **务必结合用户使用场景、从用户体验的角度去思考：为什么产品交互 要设计成这个样子**、为什么要通过 RecyclerView 去实现，为什么会提供像 SnapHelper 这种接口。

**唯有如此，你才有机会真正 想明白并且掌握** 关于 RecyclerView 的一切。像 LayoutManager、ItemDecoration、LayoutAnimation 乃至后来的 DiffUtil、SnapHelper，**它们的存在 绝非一蹴而就，绝不是死记硬背 能够消化的**，除了追根溯源到 产品设计、思考业务场景，没有别的路能走 —— 这条看似曲线救国，实则最快达成目的的学习路线。

![](https://images.xiaozhuanlan.com/photo/2019/d01061ca5d2d362b02f03eb114eaae80.gif)

![](https://images.xiaozhuanlan.com/photo/2019/8a5786ff4a6f6f1a18bf5595d07d6196.gif)

![](https://images.xiaozhuanlan.com/photo/2019/cc972f290a7f621baa40bb2023f0b89e.gif)

![](https://images.xiaozhuanlan.com/photo/2019/4de3c016abd11e252d6eee4455cc6955.gif)

![](https://images.xiaozhuanlan.com/photo/2019/39da4ee8d6a7c7aa43e8b8a63b3524cb.gif)

![](https://images.xiaozhuanlan.com/photo/2019/4af27240791483ea1373a28e2549155c.gif)

> 例如 第三方库 [LayoutManagerGroup](https://github.com/DingMouRen/LayoutManagerGroup) 提供的这 6 种场景实现，如基于 “死记硬背” 时期的不科学分类 ，就很难分清楚

由于 产品设计 铺陈开来讲，不花个 30 篇下不来，所以本专栏不会展开介绍 “产品设计” 以及 “现存自定义视图”，

不过我们决定在《滑动冲突》篇，借着 “滑动冲突” 的场景，来解析 “产品设计” 的通用底层逻辑，相信读者阅读完会耳目一新。

> 具体详见[《滑动冲突 的快乐你不懂！》](https://xiaozhuanlan.com/topic/8796215034) 篇提供的示范。

### 2.对视图标准化 API 的学习

也即通常人们所说的 “自定义控件” 的学习。

相比对 现存自定义视图的学习，我觉得这个要更容易掌握一些，毕竟既然支持自定义，就务必是标准化的、基于模版方法模式的实现，因而 **接口都是统一的、可预测、可掌握的，绝非扑朔迷离的**。

学习标准化 API，无非就是去掌握 视图的 **排版和触控（人机交互就这两样）**。所以在接下来的章节中，我们会分别介绍 排版和触控 所依赖的 **坐标系统、属性参数、事件分发机制、滑动冲突处理、视图绘制** 等等。

## 综上

视图不仅仅是技术领域的知识，更是产品领域的知识。

> 只有想明白了用户使用场景，才能想明白 现存自定义视图 及其 技术点 的存在缘由。
> 
> 自定义控件，不过是基于系统提供的标准化 API，去满足 特殊用户使用场景 的需求。

最后，这里站在产品设计的角度 分享一个屡试不爽的信条：

**用户体验的目标之一，就是洞悉用户的意图，最大限度地让操作连贯、避免被打断。**（详见下一篇 [《滑动冲突 的快乐你不懂！》](https://xiaozhuanlan.com/topic/8796215034) 对这条原则全网独家的解析）

所以平日里要 多多思考和学习 头部软件的产品设计，例如张小龙的微信（比如 为什么 朋友圈发动态的 “所在位置” **不要** 展示地图，而聊天消息中的 “发送位置” **要** 展示地图呢？）

并且，**在同类场景中 尽量照搬这些 普适的设计，从而减少用户的学习成本。只有在万不得已的情况下，才考虑自己去设计和实现控件，否则费力不讨好**。

> **便捷链接：**
> 
> **[基本功：是随时随地可受用的 深度思考原则](https://xiaozhuanlan.com/topic/9837051426)**
> 
> [GitHub : 重学安卓 配套项目](https://github.com/KunMinX/Relearn-Android)
> 
> [GitHub : Jetpack-MVVM-Best-Practice](https://github.com/KunMinX/Jetpack-MVVM-Best-Practice)
> 
> **视图系列文章：**
> 
> [重学安卓：滑动冲突 的快乐你不懂！](https://xiaozhuanlan.com/topic/8796215034)
> 
> [重学安卓：不如我们 从零开始设计一套 视图系统](https://xiaozhuanlan.com/topic/0162375948)
> 
> [重学安卓：百闻不如一见的 视图系统 架构全貌](https://xiaozhuanlan.com/topic/6420935178)
> 
> **[重学安卓：过目难忘 Android GUI 关系梳理 (墙裂推荐)](https://xiaozhuanlan.com/topic/2073915486)**
> 
> [重学安卓：一通百通 “声明式 UI” 扫盲干货](https://xiaozhuanlan.com/topic/2356748910)

## Note 2021.08.15 加餐

### 从 0 到 1 “自定义视图” 完整爬坑顺序

专栏刚起步的时候，有小伙伴问能否出一期 “自定义视图” 学习路线，经过 2 年的修订和沉淀，我想是时候出一期 —— 确切来说是 **客观上能最终导致 “胸有成竹” 的 “爬坑路线”**，

> 是的，一个最基本的原则就是，凡事唯有完整从 0 到 1 爬过坑，才会真的有体会，不然就是一头雾水，难找到北。

以下 “自定义视图” 爬坑路线：

#### 1.兴趣是最好的老师

正如我们在[《过目难忘 Android GUI 关系梳理》](https://xiaozhuanlan.com/topic/2073915486)中分析的，视图的本质是 “排版的模板”，排版的底层基石是 “绘制”，而操纵绘制的技术点是 Canvas。

因此最开始可以跟着发行于 2017 年的[《Hencoder》](https://juejin.cn/post/6844903486807785485)Canvas 绘制教程学习，透过对这一系列 “图文并茂” 教程的阅读和训练，你可尝到 “自定义绘制” 的甜头，这是后续学习最为基石的动力之所在。

![](https://images.xiaozhuanlan.com/photo/2021/3d154f9b0f3856e86d586b80ec076b40.png)

#### 2.开始发现问题

当跟着上述系列教程迈出了第一步后，随即你（有了机会）发现问题 —— 虽然图形被绘制出，但离 “实际使用” 还有一定距离，也即上述教程是 “**定向突破**” 了绘制本身，但没有介绍 “View 坐标体系” 等，导致图形的尺寸、方位与预期不符（要么太小，要么不对称，要么 … ）

![](https://images.xiaozhuanlan.com/photo/2021/d876edf737582228c1eb87289746889d.png)

于是这时候可以通过发行于 2015 年的[《Android 开发艺术探索》](https://book.douban.com/subject/26599538/)的 View 章节，来补足 View 坐标体系的基础。

#### 3.开始反思问题

然而看着看着就会发现，纸上得来终觉浅，某些必要细节的描述往往是模棱两可（只记录现象结果，不说为什么），阅读过程不太流畅、云里雾里 —— 终究还是要靠自己，自己动手打 Log 输出查看结果。

> 毕竟是关乎 “基本功” 的修炼，这个 “自行监测和检验” 的过程必不可少，人们往往出于 “畏难情绪” 而试图得过且过，然而作为基石的这一步不迈过，后续的进阶其实都免谈。

所以这个阶段的一条出路是 … 既然 Hencoder 专注的是定点突破，那么 Hencoder Plus 想必是有这方面体系化的知识来补足，

而我走过的对我个人影响深远的另一条出路就是，**基于 “第一性原理” 的反思 —— 索性跳出源码细节，首先站在 “源码设计师” 的角度反思**，当我们设计一个视图系统时，到底有哪些因素需要被考虑 —— 一旦这样思考了，很多既有现象 “为什么存在”、“为什么会设计成这个样子”，也都不言而喻，

例如

> “为什么坐标系要设计为 y 轴向下、x 向右为正方向”、
> 
> “为什么 Scroller 的正负方向被设计为与 View 坐标系相反”？
> 
> … 书本只会告诉你结果，就是不告诉你为什么
> 
> —— 这些我们在[《不如我们 从零开始设计一套 视图系统》](https://xiaozhuanlan.com/topic/0162375948)推导并展示了这么设计的缘由。

以及

> “为什么会有滑动冲突”、
> 
> “为什么事件分发要设计成这个样子”、
> 
> “滑动冲突解决方案的演变都会经历哪些历程” ——
> 
> [《滑动冲突 的起源与通用应对招式》](https://xiaozhuanlan.com/topic/8796215034)
> 
> [《学习 View 事件分发，就像外地人上了黑车》](https://juejin.cn/post/6844903894103883789)
> 
> [《透镜系列 看穿 > 触摸事件分发 >》](https://juejin.cn/post/6844903761052188679)
> 
> …

![](https://images.xiaozhuanlan.com/photo/2021/ee5a06edd1dcb570597fd0d9ae5fe0d2.png)

#### 4.继续追根溯源

当人们迈过了自定义视图的坎儿，并长足地经历了各种 “不可预期的错误” 后，便得以继续反思，要怎么做，才能让 “自定义视图” 的代码更加 “软件工程安全”，

此时我们一方面会继续基于 “第一性原理” 来 “追根溯源” 和梳理 Android GUI 各成员的关系，就像通过 [《过目难忘 Android GUI 关系梳理》](https://xiaozhuanlan.com/topic/2073915486)，我们找到了 View 体系的根 —— Canvas，

另一方面，我们会基于对业务开发过程中 “**视图实例 Null 安全**” 等高频的一致性问题的理解，以及基于对 “**函数式编程思想** 能通过范式层面的优化 来彻底解决过程的一致性问题”，而另辟蹊径地采取 “Kotlin + Compose” 等 声明式 UI 的方式来彻底解决。

> 关于 “声明式 UI” 的本质及通用打开方式，我们集中梳理到了 [《一通百通 “声明式 UI” 扫盲干货》](https://xiaozhuanlan.com/topic/2356748910)

—— 也即至此，我们对 “视图系统” 的理解得以通透简练，明白 “Android GUI Client API 的母亲是 Canvas，**Canvas 总共生了两胎，一胎是 View 体系，二胎是 Compose 体系**”。

![](https://images.xiaozhuanlan.com/photo/2021/fed68326182e140eaedb38b938a3db33.png)

#### 5.跳出技术圈的追溯

视图的尽头是交互，交互的尽头是产品。

拘泥于代码，从不反思产品和设计，很难进阶为一名独立开发者。

举个例子：

同样是点赞功能，微信朋友圈 “点赞” 的设计，却和社区信息流列表的 “点赞” 有着本质区别，

![](https://images.xiaozhuanlan.com/photo/2021/3bbbf12c42309fe4eebefe12f5b9fdeb.png)

—— 为什么朋友圈需要将 “点赞” 收纳在 “…” 中？因为要结合实际场景考虑：

> 社区是 “**陌生人关系**”，点赞只需增长数值即可，
> 
> 朋友圈就不一样了，朋友圈是 “**联系人关系**”，你的每个点赞，不仅要考虑将名字出现在你 “朋友圈”，还要出现在所有共同联系人的 “朋友圈” —— 这动作可大了，所以务必收纳在 “…” 来阻碍无聊的人拿这个 “暴力测试” 找乐子。

所以开发微信朋友圈，优先考虑如何通过 PopupWindow 等方式实现 “…” 的弹出，而开发社区列表的时候，倒是需要花点心思，例如点赞时加个特色动画，来留住用户的心。

![](https://images.xiaozhuanlan.com/photo/2021/6097c07caf145cb97c7ac9d2340295be.png)

#### 6.继续修炼

鉴于 Compose 刚满月，离普及还有很长一段距离，时下我们可以尝试的还有很多，

例如

通过 MotionLayout 来代替属性动画（在多数场景下可以让动画的实现更简便），

多点触控的应用（例如开发相册时，想让图片列表像 iOS 相册一样可以放大缩小预览图，那么多点触控的知识必不可少）

…

## Note 2020.07.07 加餐

### 重学安卓 开源库 内部共享计划

![](https://images.xiaozhuanlan.com/photo/2020/bcb8996a42f176fcf63e13f8ad728d81.png)

为促进小伙伴们对技术点的持续跟进与交流，我们创建了 OpenBug 仓库，可在 issue 区投稿个人开源项目。

基于本仓库的初衷，目前暂不考虑对外公布，仅用于《重学安卓》交流群内部交流。

项目开发中有需求，可优先考虑试用本仓库中登记过的开源库，因为作者就在群里，能找到人、能及时反馈。

与此同时，项目作者也有机会 借助实战场景的 bug 反馈，将开源项目成熟完善。

> [https://github.com/OpenBug-Android/OpenBug-Android](https://github.com/OpenBug-Android/OpenBug-Android)

## 版权声明

> Copyright © 2019-present KunMinX

**本文为专栏私有内容，谢绝转载**。

读者订阅了专栏，即享有了专栏文章的阅读权。

文章 **原创的引言、切入点、思路、结论** 凝聚了作者 KunMinX 本人的心血 及与参与者互动演化的结果，作者本人及作者在文中提名的有效贡献者 对相应的成果享有所有权。

**当您 借鉴或引用文中的引言、切入点、思路、结论 进行二次创作并打算发行时，须注明链接出处**，否则我们保留追责的权利。对此如有疑虑请及时沟通，或在发行前将作品交由本人核对。

当您看见有人 [洗稿](https://baike.baidu.com/item/%E6%B4%97%E7%A8%BF/20862574?fr=aladdin)、[剽窃](https://baike.baidu.com/item/%E5%89%BD%E7%AA%83/9398357?fr=aladdin)、未经授权转载本专栏的文章内容时，请及时向本人举报。

最后感谢您对专栏内容的阅读和喜欢。

> [往期回顾](https://kunminx.gitbook.io/relearn-android/new_moments/zhong-xue-an-zhuo-liang-zhou-nian-hui-gu-yu-zhan-wang)，**[专栏目录](https://kunminx.gitbook.io/relearn-android/category)**，**[更新动态](https://kunminx.gitbook.io/relearn-android/new_moments)**，[优惠政策](https://kunminx.gitbook.io/relearn-android/ban-quan-sheng-ming#you-hui-zheng-ce)，[版权须知](https://kunminx.gitbook.io/relearn-android/ban-quan-sheng-ming#ban-quan-xu-zhi)
> 
> 温馨提示：如果这是第一次接触《重学安卓》，可通过上述链接来访问和快速了解《重学安卓》专栏、获取它的目录、试读内容，以及了解它的最新动态 和 发展状况。
> 
> 截至目前，专栏已对 **体系化文章** 做了 1970 余次修订，数十位群友告诉我 受专栏的启发 他们也开启了写作之路。群里不定期会有小伙伴讨论适配问题、分享原创的开源库 和 提供内推机会，订阅后可随时进群交流。

·

> Note 2021.5.25 **重要提示**：
> 
> 阅读本文的最佳时机是，**您已吃过** 阅读 “源码” 或 “源码分析文” 时 **找不到头绪的苦**。
> 
> 您还没吃过苦，那您先不要着急阅读本文。您得吃过苦，才会有体会。
> 
> 在您吃够这方面的苦后，您才有机会发现，本文正是专用于解决 “如何选择和归类自定义控件” 的困扰。
> 
> 我们 **绝不通篇贴源码**，而是基于广泛的实践和反思，在累积过大量样本 乃至足以排除掉所有干扰信息后，**点到为止地揭露 “视图交互 乃至 产品设计” 最为核心的本质**，方便您理解背后的底层逻辑，乃至可以笃信地 选择或实现合适的自定义控件在项目中使用。

## 前言

在过去的几个月中，我们分别 深入浅出地复盘了 视图控制器的 **生命周期、重建机制、状态管理、页面通信、路由导航**，以及作为 标准化开发模式的 **Jetpack MVVM 最佳实践**。

相信经过几个月的实践、反思和沉淀，小伙伴们对作为 “应用开发骨架” 的 “视图控制器” 及其 “标准化开发框架” 已胸有成竹。

本来随后我是想直接开讲自定义视图，但如果像其他网文一样，一上来就介绍细枝末节的技术点，那恐怕会很让人感到沮丧，找不到支点来立足和展开。

> 并且值得注意的是，**自定义视图学习的切入点，并不全在技术领域内**。

因此，在正式开讲自定义视图的技术知识之前，我决定 **通过这样一篇 “导读” 来做个预热**，方便小伙伴们对后续章节具体内容的学习。

## 文章目录一览

-   前言
-   死记硬背时期 的混沌世界
-   深度思考眼中 的自定义视图
    -   对现存自定义视图的学习
    -   对视图标准化 API 的学习
-   综上
-   **Note 2021.08.15 加餐：**
    -   **从 0 到 1 “自定义视图” 完整爬坑顺序**
-   **Note 2020.07.07 加餐：**
    -   重学安卓 开源库 内部共享计划

## 死记硬背时期 的混沌世界

记得刚参加工作不久的时候，我也和多数人一样，思维还停留在 学生时代 死记硬背的水平，老想着 大而全、蛇吞象，想把所有东西都整理好、强迫自己记下来。

最初我的策略是，将控件 按覆盖面积 分类，例如 导航类、表单类、展示类、容器类，等等。然后不断地收集关于它们的第三方库、Google 自家控件的知识点等等。

一开始是有一点效果，知道控件怎么用，但也就到这种程度为止，过一段时间，便通通遗忘。

更糟糕的是，这种 **不科学的管理方式，使得对控件的管理逐渐失控**，每当有新的控件被我相中时，我却不知道将其归类到哪个目录下为好。

![](https://images.xiaozhuanlan.com/photo/2019/1b9424e73b7017e91453ad17da387366.png)

我相信很多人都有过这样的经历，**最开始十分努力，后来不了了之**。

有的人从此开启了咸鱼模式，反正这也学不好，那也学不好，干脆得过且过、混吃等死。另有的人则是加倍努力，然后背下来的知识，也加倍地忘记 …

那么有多少人真的反思过，**是不是自己的思考方式出了问题呢**？

由于时间过去了太久，我不想展开介绍 从死记硬背 到深度思考，这期间我究竟经历了些什么，乃至于有了这样的领悟。但正如你们看到的，前面几期关于视图控制和 MVVM 深入浅出的介绍，都是来自深度思考的结果。

**深度思考 不一定能带来 绝对正确的结论，但却一定是自恰的、能让自己信服从而义无反顾地行动**。

深度思考的精髓就在于 **探究为什么、探究事物存在的缘由。凡事把这个想明白，就能透过现象抓住本质**。（详见 [《基本功：是随时随地可受用的 深度思考原则》](https://xiaozhuanlan.com/topic/9837051426) 篇的解析）

## 深度思考眼中的自定义视图

所以，在形成了深度思考的习惯后，我对视图的学习，也发生了翻天覆地的变化。

不再是一上来就 死记硬背是什么 和 练习怎么用。

而是首先思考，自定义视图 为什么存在？（凡是 View 的实现类，都算自定义视图，不要觉得 Google 默认实现的就不算、只有自己实现的才算）

**视图的存在，对用户来说，是为了满足 所见即所得 的人机交互需求；对开发者来说，是为了能够定制视图 来提供合适的用户体验。**

换言之，

若不是为了满足用户 对 **所见即所得** 的需求，视图根本不需要存在，给个黑底白字的命令行就行了。

若不是为了让开发者 能够定制视图 来提供合适的用户体验，视图也不需要通过 模版方法模式 和 组合模式 来 **设计出标准化的 API、供开发者定制、并且由 统一的视图管理机制 在后台运筹帷幄**。

所以至此，我们发掘并确立了视图的两大学习方向：

### 1.对现存自定义视图的学习

如果你想掌握 市面上已有的 自定义视图，例如 RecyclerView，那么 **务必结合用户使用场景、从用户体验的角度去思考：为什么产品交互 要设计成这个样子**、为什么要通过 RecyclerView 去实现，为什么会提供像 SnapHelper 这种接口。

**唯有如此，你才有机会真正 想明白并且掌握** 关于 RecyclerView 的一切。像 LayoutManager、ItemDecoration、LayoutAnimation 乃至后来的 DiffUtil、SnapHelper，**它们的存在 绝非一蹴而就，绝不是死记硬背 能够消化的**，除了追根溯源到 产品设计、思考业务场景，没有别的路能走 —— 这条看似曲线救国，实则最快达成目的的学习路线。

![](https://images.xiaozhuanlan.com/photo/2019/d01061ca5d2d362b02f03eb114eaae80.gif)

![](https://images.xiaozhuanlan.com/photo/2019/8a5786ff4a6f6f1a18bf5595d07d6196.gif)

![](https://images.xiaozhuanlan.com/photo/2019/cc972f290a7f621baa40bb2023f0b89e.gif)

![](https://images.xiaozhuanlan.com/photo/2019/4de3c016abd11e252d6eee4455cc6955.gif)

![](https://images.xiaozhuanlan.com/photo/2019/39da4ee8d6a7c7aa43e8b8a63b3524cb.gif)

![](https://images.xiaozhuanlan.com/photo/2019/4af27240791483ea1373a28e2549155c.gif)

> 例如 第三方库 [LayoutManagerGroup](https://github.com/DingMouRen/LayoutManagerGroup) 提供的这 6 种场景实现，如基于 “死记硬背” 时期的不科学分类 ，就很难分清楚

由于 产品设计 铺陈开来讲，不花个 30 篇下不来，所以本专栏不会展开介绍 “产品设计” 以及 “现存自定义视图”，

不过我们决定在《滑动冲突》篇，借着 “滑动冲突” 的场景，来解析 “产品设计” 的通用底层逻辑，相信读者阅读完会耳目一新。

> 具体详见[《滑动冲突 的快乐你不懂！》](https://xiaozhuanlan.com/topic/8796215034) 篇提供的示范。

### 2.对视图标准化 API 的学习

也即通常人们所说的 “自定义控件” 的学习。

相比对 现存自定义视图的学习，我觉得这个要更容易掌握一些，毕竟既然支持自定义，就务必是标准化的、基于模版方法模式的实现，因而 **接口都是统一的、可预测、可掌握的，绝非扑朔迷离的**。

学习标准化 API，无非就是去掌握 视图的 **排版和触控（人机交互就这两样）**。所以在接下来的章节中，我们会分别介绍 排版和触控 所依赖的 **坐标系统、属性参数、事件分发机制、滑动冲突处理、视图绘制** 等等。

## 综上

视图不仅仅是技术领域的知识，更是产品领域的知识。

> 只有想明白了用户使用场景，才能想明白 现存自定义视图 及其 技术点 的存在缘由。
> 
> 自定义控件，不过是基于系统提供的标准化 API，去满足 特殊用户使用场景 的需求。

最后，这里站在产品设计的角度 分享一个屡试不爽的信条：

**用户体验的目标之一，就是洞悉用户的意图，最大限度地让操作连贯、避免被打断。**（详见下一篇 [《滑动冲突 的快乐你不懂！》](https://xiaozhuanlan.com/topic/8796215034) 对这条原则全网独家的解析）

所以平日里要 多多思考和学习 头部软件的产品设计，例如张小龙的微信（比如 为什么 朋友圈发动态的 “所在位置” **不要** 展示地图，而聊天消息中的 “发送位置” **要** 展示地图呢？）

并且，**在同类场景中 尽量照搬这些 普适的设计，从而减少用户的学习成本。只有在万不得已的情况下，才考虑自己去设计和实现控件，否则费力不讨好**。

> **便捷链接：**
> 
> **[基本功：是随时随地可受用的 深度思考原则](https://xiaozhuanlan.com/topic/9837051426)**
> 
> [GitHub : 重学安卓 配套项目](https://github.com/KunMinX/Relearn-Android)
> 
> [GitHub : Jetpack-MVVM-Best-Practice](https://github.com/KunMinX/Jetpack-MVVM-Best-Practice)
> 
> **视图系列文章：**
> 
> [重学安卓：滑动冲突 的快乐你不懂！](https://xiaozhuanlan.com/topic/8796215034)
> 
> [重学安卓：不如我们 从零开始设计一套 视图系统](https://xiaozhuanlan.com/topic/0162375948)
> 
> [重学安卓：百闻不如一见的 视图系统 架构全貌](https://xiaozhuanlan.com/topic/6420935178)
> 
> **[重学安卓：过目难忘 Android GUI 关系梳理 (墙裂推荐)](https://xiaozhuanlan.com/topic/2073915486)**
> 
> [重学安卓：一通百通 “声明式 UI” 扫盲干货](https://xiaozhuanlan.com/topic/2356748910)

## Note 2021.08.15 加餐

### 从 0 到 1 “自定义视图” 完整爬坑顺序

专栏刚起步的时候，有小伙伴问能否出一期 “自定义视图” 学习路线，经过 2 年的修订和沉淀，我想是时候出一期 —— 确切来说是 **客观上能最终导致 “胸有成竹” 的 “爬坑路线”**，

> 是的，一个最基本的原则就是，凡事唯有完整从 0 到 1 爬过坑，才会真的有体会，不然就是一头雾水，难找到北。

以下 “自定义视图” 爬坑路线：

#### 1.兴趣是最好的老师

正如我们在[《过目难忘 Android GUI 关系梳理》](https://xiaozhuanlan.com/topic/2073915486)中分析的，视图的本质是 “排版的模板”，排版的底层基石是 “绘制”，而操纵绘制的技术点是 Canvas。

因此最开始可以跟着发行于 2017 年的[《Hencoder》](https://juejin.cn/post/6844903486807785485)Canvas 绘制教程学习，透过对这一系列 “图文并茂” 教程的阅读和训练，你可尝到 “自定义绘制” 的甜头，这是后续学习最为基石的动力之所在。

![](https://images.xiaozhuanlan.com/photo/2021/3d154f9b0f3856e86d586b80ec076b40.png)

#### 2.开始发现问题

当跟着上述系列教程迈出了第一步后，随即你（有了机会）发现问题 —— 虽然图形被绘制出，但离 “实际使用” 还有一定距离，也即上述教程是 “**定向突破**” 了绘制本身，但没有介绍 “View 坐标体系” 等，导致图形的尺寸、方位与预期不符（要么太小，要么不对称，要么 … ）

![](https://images.xiaozhuanlan.com/photo/2021/d876edf737582228c1eb87289746889d.png)

于是这时候可以通过发行于 2015 年的[《Android 开发艺术探索》](https://book.douban.com/subject/26599538/)的 View 章节，来补足 View 坐标体系的基础。

#### 3.开始反思问题

然而看着看着就会发现，纸上得来终觉浅，某些必要细节的描述往往是模棱两可（只记录现象结果，不说为什么），阅读过程不太流畅、云里雾里 —— 终究还是要靠自己，自己动手打 Log 输出查看结果。

> 毕竟是关乎 “基本功” 的修炼，这个 “自行监测和检验” 的过程必不可少，人们往往出于 “畏难情绪” 而试图得过且过，然而作为基石的这一步不迈过，后续的进阶其实都免谈。

所以这个阶段的一条出路是 … 既然 Hencoder 专注的是定点突破，那么 Hencoder Plus 想必是有这方面体系化的知识来补足，

而我走过的对我个人影响深远的另一条出路就是，**基于 “第一性原理” 的反思 —— 索性跳出源码细节，首先站在 “源码设计师” 的角度反思**，当我们设计一个视图系统时，到底有哪些因素需要被考虑 —— 一旦这样思考了，很多既有现象 “为什么存在”、“为什么会设计成这个样子”，也都不言而喻，

例如

> “为什么坐标系要设计为 y 轴向下、x 向右为正方向”、
> 
> “为什么 Scroller 的正负方向被设计为与 View 坐标系相反”？
> 
> … 书本只会告诉你结果，就是不告诉你为什么
> 
> —— 这些我们在[《不如我们 从零开始设计一套 视图系统》](https://xiaozhuanlan.com/topic/0162375948)推导并展示了这么设计的缘由。

以及

> “为什么会有滑动冲突”、
> 
> “为什么事件分发要设计成这个样子”、
> 
> “滑动冲突解决方案的演变都会经历哪些历程” ——
> 
> [《滑动冲突 的起源与通用应对招式》](https://xiaozhuanlan.com/topic/8796215034)
> 
> [《学习 View 事件分发，就像外地人上了黑车》](https://juejin.cn/post/6844903894103883789)
> 
> [《透镜系列 看穿 > 触摸事件分发 >》](https://juejin.cn/post/6844903761052188679)
> 
> …

![](https://images.xiaozhuanlan.com/photo/2021/ee5a06edd1dcb570597fd0d9ae5fe0d2.png)

#### 4.继续追根溯源

当人们迈过了自定义视图的坎儿，并长足地经历了各种 “不可预期的错误” 后，便得以继续反思，要怎么做，才能让 “自定义视图” 的代码更加 “软件工程安全”，

此时我们一方面会继续基于 “第一性原理” 来 “追根溯源” 和梳理 Android GUI 各成员的关系，就像通过 [《过目难忘 Android GUI 关系梳理》](https://xiaozhuanlan.com/topic/2073915486)，我们找到了 View 体系的根 —— Canvas，

另一方面，我们会基于对业务开发过程中 “**视图实例 Null 安全**” 等高频的一致性问题的理解，以及基于对 “**函数式编程思想** 能通过范式层面的优化 来彻底解决过程的一致性问题”，而另辟蹊径地采取 “Kotlin + Compose” 等 声明式 UI 的方式来彻底解决。

> 关于 “声明式 UI” 的本质及通用打开方式，我们集中梳理到了 [《一通百通 “声明式 UI” 扫盲干货》](https://xiaozhuanlan.com/topic/2356748910)

—— 也即至此，我们对 “视图系统” 的理解得以通透简练，明白 “Android GUI Client API 的母亲是 Canvas，**Canvas 总共生了两胎，一胎是 View 体系，二胎是 Compose 体系**”。

![](https://images.xiaozhuanlan.com/photo/2021/fed68326182e140eaedb38b938a3db33.png)

#### 5.跳出技术圈的追溯

视图的尽头是交互，交互的尽头是产品。

拘泥于代码，从不反思产品和设计，很难进阶为一名独立开发者。

举个例子：

同样是点赞功能，微信朋友圈 “点赞” 的设计，却和社区信息流列表的 “点赞” 有着本质区别，

![](https://images.xiaozhuanlan.com/photo/2021/3bbbf12c42309fe4eebefe12f5b9fdeb.png)

—— 为什么朋友圈需要将 “点赞” 收纳在 “…” 中？因为要结合实际场景考虑：

> 社区是 “**陌生人关系**”，点赞只需增长数值即可，
> 
> 朋友圈就不一样了，朋友圈是 “**联系人关系**”，你的每个点赞，不仅要考虑将名字出现在你 “朋友圈”，还要出现在所有共同联系人的 “朋友圈” —— 这动作可大了，所以务必收纳在 “…” 来阻碍无聊的人拿这个 “暴力测试” 找乐子。

所以开发微信朋友圈，优先考虑如何通过 PopupWindow 等方式实现 “…” 的弹出，而开发社区列表的时候，倒是需要花点心思，例如点赞时加个特色动画，来留住用户的心。

![](https://images.xiaozhuanlan.com/photo/2021/6097c07caf145cb97c7ac9d2340295be.png)

#### 6.继续修炼

鉴于 Compose 刚满月，离普及还有很长一段距离，时下我们可以尝试的还有很多，

例如

通过 MotionLayout 来代替属性动画（在多数场景下可以让动画的实现更简便），

多点触控的应用（例如开发相册时，想让图片列表像 iOS 相册一样可以放大缩小预览图，那么多点触控的知识必不可少）

…

## Note 2020.07.07 加餐

### 重学安卓 开源库 内部共享计划

![](https://images.xiaozhuanlan.com/photo/2020/bcb8996a42f176fcf63e13f8ad728d81.png)

为促进小伙伴们对技术点的持续跟进与交流，我们创建了 OpenBug 仓库，可在 issue 区投稿个人开源项目。

基于本仓库的初衷，目前暂不考虑对外公布，仅用于《重学安卓》交流群内部交流。

项目开发中有需求，可优先考虑试用本仓库中登记过的开源库，因为作者就在群里，能找到人、能及时反馈。

与此同时，项目作者也有机会 借助实战场景的 bug 反馈，将开源项目成熟完善。

> [https://github.com/OpenBug-Android/OpenBug-Android](https://github.com/OpenBug-Android/OpenBug-Android)

## 版权声明

> Copyright © 2019-present KunMinX

**本文为专栏私有内容，谢绝转载**。

读者订阅了专栏，即享有了专栏文章的阅读权。

文章 **原创的引言、切入点、思路、结论** 凝聚了作者 KunMinX 本人的心血 及与参与者互动演化的结果，作者本人及作者在文中提名的有效贡献者 对相应的成果享有所有权。

**当您 借鉴或引用文中的引言、切入点、思路、结论 进行二次创作并打算发行时，须注明链接出处**，否则我们保留追责的权利。对此如有疑虑请及时沟通，或在发行前将作品交由本人核对。

当您看见有人 [洗稿](https://baike.baidu.com/item/%E6%B4%97%E7%A8%BF/20862574?fr=aladdin)、[剽窃](https://baike.baidu.com/item/%E5%89%BD%E7%AA%83/9398357?fr=aladdin)、未经授权转载本专栏的文章内容时，请及时向本人举报。

最后感谢您对专栏内容的阅读和喜欢。